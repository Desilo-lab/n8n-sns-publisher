# 콘텐츠 자동화 파이프라인 설계

Issue #15 (멀티미디어) + Issue #16 (SNS 발행) 통합

## 전체 플로우

```
┌─────────────────────────────────────────────────────────────────┐
│                        TRIGGER                                   │
├─────────────────────────────────────────────────────────────────┤
│  GitHub Push: content/retro/*.md                                │
│  또는 Manual Trigger (테스트용)                                  │
└────────────────────────┬────────────────────────────────────────┘
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│                   1. CONTENT PARSING                            │
├─────────────────────────────────────────────────────────────────┤
│  - 마크다운 프론트매터 파싱                                      │
│  - 실험 결과 요약 추출                                           │
│  - 플랫폼별 텍스트 생성 (길이 조정)                              │
└────────────────────────┬────────────────────────────────────────┘
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│                   2. IMAGE GENERATION (Issue #15)               │
├─────────────────────────────────────────────────────────────────┤
│  ┌──────────┐    ┌──────────┐    ┌──────────┐                  │
│  │ Claude   │ →  │ DALL-E 3 │ →  │ Upload   │                  │
│  │ (Prompt) │    │ (Image)  │    │ (S3/R2)  │                  │
│  └──────────┘    └──────────┘    └──────────┘                  │
│                                                                  │
│  대안: NanoBanana2, Midjourney (Discord bot)                    │
└────────────────────────┬────────────────────────────────────────┘
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│                   3. CAROUSEL/SLIDES (Issue #15)                │
├─────────────────────────────────────────────────────────────────┤
│  ┌──────────┐    ┌──────────┐                                   │
│  │ Gamma    │ or │ Figma    │  → 슬라이드 이미지 생성            │
│  │ API      │    │ Template │                                   │
│  └──────────┘    └──────────┘                                   │
│                                                                  │
│  용도: LinkedIn/Instagram 캐러셀                                 │
└────────────────────────┬────────────────────────────────────────┘
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│                   4. AUDIO/VIDEO (Issue #15)                    │
├─────────────────────────────────────────────────────────────────┤
│  ┌──────────┐    ┌──────────┐    ┌──────────┐                  │
│  │ElevenLabs│ →  │ Runway   │ →  │ CapCut   │                  │
│  │ (TTS)    │    │ (Video)  │    │ (Edit)   │                  │
│  └──────────┘    └──────────┘    └──────────┘                  │
│                                                                  │
│  30-60초 숏폼 영상                                               │
└────────────────────────┬────────────────────────────────────────┘
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│                   5. SNS PUBLISHING (Issue #16)                 │
├─────────────────────────────────────────────────────────────────┤
│  ┌────────────────────────────────────────────────────────┐    │
│  │                    PARALLEL PUBLISH                     │    │
│  │  ┌─────┐    ┌─────────┐    ┌──────────┐               │    │
│  │  │  X  │    │ Threads │    │ LinkedIn │               │    │
│  │  │     │    │         │    │          │               │    │
│  │  │Text │    │Text+Img │    │Carousel  │               │    │
│  │  │+Img │    │         │    │+Article  │               │    │
│  │  └─────┘    └─────────┘    └──────────┘               │    │
│  └────────────────────────────────────────────────────────┘    │
└────────────────────────┬────────────────────────────────────────┘
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│                   6. NOTIFICATION                               │
├─────────────────────────────────────────────────────────────────┤
│  - Discord: 발행 완료 알림 + 링크                               │
│  - Slack: 팀 알림 (선택)                                        │
│  - GitHub Issue: 코멘트로 결과 기록                              │
└─────────────────────────────────────────────────────────────────┘
```

---

## n8n 워크플로우 구성

### Phase 1: SNS 텍스트 발행 (현재)
- `workflow.json` - 기본 텍스트 발행

### Phase 2: 이미지 생성 추가
- `workflow-with-image.json`
- DALL-E 3 또는 NanoBanana2 연동

### Phase 3: 영상 생성 추가
- `workflow-full.json`
- ElevenLabs + Runway 연동

---

## 환경변수 (전체)

```env
# Phase 1 - SNS
X_API_KEY=
THREADS_ACCESS_TOKEN=
LINKEDIN_ACCESS_TOKEN=
DISCORD_WEBHOOK_URL=

# Phase 2 - 이미지
OPENAI_API_KEY=          # DALL-E 3
CLOUDFLARE_R2_KEY=       # 이미지 저장

# Phase 3 - 영상
ELEVENLABS_API_KEY=      # TTS
RUNWAY_API_KEY=          # 영상 생성
```

---

## 비용 추정

| 단계 | 도구 | 예상 비용/건 |
|------|------|-------------|
| 이미지 | DALL-E 3 | $0.04 |
| TTS | ElevenLabs | $0.01 |
| 영상 | Runway | $0.05 |
| **합계** | | **~$0.10/콘텐츠** |

---

## Railway 배포

```bash
# 1. GitHub 레포 연결
railway link

# 2. PostgreSQL 추가
railway add postgresql

# 3. 환경변수 설정
railway variables set N8N_BASIC_AUTH_USER=admin
railway variables set N8N_BASIC_AUTH_PASSWORD=xxx
# ... 나머지 API 키들

# 4. 배포
railway up
```

Docker 이미지 직접 사용:
```
n8nio/n8n:latest
```

Railway는 Dockerfile 자동 감지하므로 그냥 push하면 됨.
